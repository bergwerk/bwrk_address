{"version":3,"sources":["general.js"],"names":["BwrkAddressMap","map","id","options","center","lat","lng","zoom","scrollwheel","styles","googleElement","pageId","geoCoder","distanceMatrix","geoCodeMarkers","searchBox","customMarkerIcon","markers","init","mapDiv","document","getElementById","google","maps","Map","Geocoder","DistanceMatrixService","$","parent","find","that","forEach","element","index","tmpMarker","Marker","position","title","icon","marker_id","uid","addListener","ajax","method","url","data","done","content","InfoWindow","open","submit","inputValue","val","codeAddress","address","geocode","results","status","GeocoderStatus","OK","setMapOnAll","result","nearestMarkerObject","measureDistance","geometry","location","nearestMarker","locationMarker","push","fitBounds","origin","R","distances","closest","i","length","mlat","mlng","dLat","rad","dLong","a","Math","sin","cos","c","atan2","sqrt","d","setMap","x","PI","bounds","LatLngBounds","extend","getPosition"],"mappings":"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","file":"app.js","sourcesContent":["var BwrkAddressMap = {\n    map: {\n        id: null,\n        options: {\n            center: {\n                lat: null,\n                lng: null\n            },\n            zoom: null,\n            scrollwheel: false,\n            styles: null\n        },\n        googleElement: null\n    },\n    pageId: null,\n    geoCoder: null,\n    distanceMatrix: null,\n    geoCodeMarkers: [],\n    searchBox: null,\n    customMarkerIcon: null,\n    markers: null,\n    init: function () {\n        var mapDiv = document.getElementById(this.map.id);\n        this.map.googleElement = new google.maps.Map(mapDiv, this.map.options);\n\n        this.geoCoder = new google.maps.Geocoder();\n        this.distanceMatrix = new google.maps.DistanceMatrixService();\n        this.searchBox = $('#' + this.map.id).parent('.tx-bwrk-markermap').find('.tx-bwrk-markermap__searchbox');\n\n        var that = this;\n        this.markers.forEach(function (element, index) {\n            var tmpMarker = new google.maps.Marker({\n                position: element.position,\n                map: that.map.googleElement,\n                title: element.title,\n                icon: element.icon,\n                marker_id: element.uid\n            });\n            tmpMarker.addListener('click', function () {\n                $.ajax({\n                    method: \"GET\",\n                    url: \"index.php\",\n                    data: {\n                        'id' : that.pageId,\n                        'eID': 'bwrkMarkerWindow',\n                        'tx_bwrkmarkermap_pi2[uid]': tmpMarker.marker_id\n                    }\n                }).done(function (content) {\n                    new google.maps.InfoWindow({\n                        content: content\n                    }).open(that.map.googleElement, tmpMarker);\n                });\n            });\n        });\n\n        this.searchBox.find('form').submit(function () {\n            var inputValue = $(this).find('input[name=\"tx-bwrk-markermap__searchbox-input\"]').val();\n            that.codeAddress(inputValue);\n            return false;\n        });\n\n    },\n    codeAddress: function (address) {\n        var that = this;\n        this.geoCoder.geocode({\n                'address': address,\n                'region': 'de'\n            },\n            function (results, status) {\n                if (status == google.maps.GeocoderStatus.OK) {\n                    that.setMapOnAll(that.geoCodeMarkers, null);\n\n                    var result = results[0];\n                    var nearestMarkerObject = that.measureDistance(result.geometry.location);\n                    var nearestMarker = new google.maps.Marker({\n                        position: nearestMarkerObject.position\n                    });\n\n                    var locationMarker = new google.maps.Marker({\n                        map: that.map.googleElement,\n                        position: result.geometry.location,\n                        icon: that.customMarkerIcon\n                    });\n                    that.geoCodeMarkers.push(locationMarker);\n\n                    var markers = [];\n                    markers[0] = locationMarker;\n                    markers[1] = nearestMarker;\n                    that.fitBounds(markers);\n                }\n            });\n    },\n    measureDistance: function (origin) {\n        var lat = origin.lat();\n        var lng = origin.lng();\n        var R = 6371; // radius of earth in km\n        var distances = [];\n        var closest = -1;\n        var that = this;\n\n        for (i = 0; i < this.markers.length; i++) {\n            var mlat = that.markers[i].position.lat;\n            var mlng = that.markers[i].position.lng;\n            var dLat = that.rad(mlat - lat);\n            var dLong = that.rad(mlng - lng);\n            var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n                Math.cos(that.rad(lat)) * Math.cos(that.rad(lat)) * Math.sin(dLong / 2) * Math.sin(dLong / 2);\n            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n            var d = R * c;\n            distances[i] = d;\n            if (closest == -1 || d < distances[closest]) {\n                closest = i;\n            }\n        }\n        return this.markers[closest];\n    },\n    setMapOnAll: function (markers, map) {\n        for (var i = 0; i < markers.length; i++) {\n            markers[i].setMap(map);\n        }\n    },\n    rad: function (x) {\n        return x * Math.PI / 180;\n    },\n    fitBounds: function (markers) {\n        var bounds = new google.maps.LatLngBounds();\n        for (var i = 0; i < markers.length; i++) {\n            bounds.extend(markers[i].getPosition());\n        }\n        this.map.googleElement.fitBounds(bounds);\n    }\n};"],"sourceRoot":"/source/"}